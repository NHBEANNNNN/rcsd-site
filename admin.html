<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>管理员后台 - LSPD</title>
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
  <nav class="nav">
    <div class="brand">
      <img src="assets/img/LSPD LOGO.png" alt="logo" style="width:40px;height:40px;object-fit:contain">
      <span class="title">洛圣都市警察局 · 管理后台</span>
    </div>
    <div class="links">
      <a href="index.html">首页</a>
      <a href="profile.html">我的资料</a>
      <a href="javascript:void(0)" id="logoutBtn">退出</a>
    </div>
  </nav>
  <main>
    <h2>警员管理</h2>
    <div id="userList">加载中...</div>
    <h3>资料编辑</h3>
    <form id="f">
      <input id="name" placeholder="姓名">
      <input id="badge" placeholder="编号">
      <input id="callsign" placeholder="呼号">
      <input id="division" placeholder="部门">
      <input id="status" placeholder="状态">
      <input id="phone" placeholder="电话">
      <input id="email" placeholder="邮箱">
      <button type="button" id="saveBtn">保存</button>
    </form>
    <h3>角色管理</h3>
    <input id="adminEmail" placeholder="邮箱">
    <button id="grantBtn">授予管理员</button>
  </main>
  <script type="module">
    import { auth, requireAdmin, doLogout, listAllUsers, readUserDoc, writeUserDoc, setAdminByEmail } from "./assets/js/auth.js";
    requireAdmin();
    document.getElementById("logoutBtn").addEventListener("click", doLogout);
    async function renderList(){
      const users = await listAllUsers();
      const div = document.getElementById("userList");
      div.innerHTML = users.map(u=>"<div>"+(u.name||"未命名")+"("+u.email+")</div>").join("");
    }
    renderList();
    document.getElementById("saveBtn").addEventListener("click", async ()=>{
      const data = { name: f.name.value, badge:f.badge.value, callsign:f.callsign.value, division:f.division.value, status:f.status.value, phone:f.phone.value, email:f.email.value };
      await writeUserDoc(auth.currentUser.uid, data);
      alert("已保存");
    });
    document.getElementById("grantBtn").addEventListener("click", async ()=>{
      const email=document.getElementById("adminEmail").value.trim().toLowerCase();
      await setAdminByEmail(email);
      alert("已授予管理员:"+email);
    });
  </script>
  <script type="module" src="assets/js/admin.js"></script>
</body>
</html>
